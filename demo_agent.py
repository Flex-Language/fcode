#!/usr/bin/env python3
"""
Demo script showing Flex AI Agent capabilities.
"""

import asyncio
import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from agents.flex_agent import FlexAIAgent
from agents.models import FlexCodeRequest, FlexSyntaxStyle, FileOperation
from config.settings import get_settings


async def demo_agent_capabilities():
    """Demonstrate the full capabilities of the Flex AI Agent."""
    print("ğŸ­ FLEX AI AGENT DEMONSTRATION")
    print("=" * 50)
    
    try:
        # Initialize the agent
        print("\nğŸš€ Initializing Flex AI Agent...")
        settings = get_settings()
        agent = FlexAIAgent(settings)
        print("âœ… Agent initialized successfully!")
        
        # Demonstrate model management
        print(f"\nğŸ“‹ MODEL MANAGEMENT")
        models = await agent.model_manager.list_models()
        print(f"ğŸ“Š Found {len(models)} available models")
        
        # Show some popular models
        popular_models = ["anthropic/claude", "openai/gpt", "mistralai/", "meta-llama/"]
        print("ğŸ”¥ Popular models available:")
        for model in models[:10]:  # Show first 10
            for popular in popular_models:
                if popular in model.id:
                    print(f"   â€¢ {model.name} ({model.id})")
                    break
        
        # Demonstrate code validation
        print(f"\nğŸ” CODE VALIDATION")
        
        # Test Franco code
        franco_code = """
        // Franco syntax example
        rakm counter = 0
        karr i=0 l7d 5 {
            etb3("Number: " + i)
            counter = counter + 1
        }
        etb3("Final counter: " + counter)
        """
        
        validation = await agent.code_validator.validate_code(franco_code)
        print("ğŸ“ Franco code validation:")
        print(f"   âœ… Errors: {len(validation.errors)}")
        print(f"   âš ï¸  Warnings: {len(validation.warnings)}")
        print(f"   ğŸ’¡ Suggestions: {len(validation.suggestions)}")
        print(f"   ğŸ¯ Syntax detected: {validation.syntax_style}")
        
        # Test unsafe Franco code
        unsafe_code = """
        dorg myArray = [1, 2, 3, 4, 5]
        karr i=0 l7d length(myArray) {
            etb3(myArray[i])
        }
        """
        
        unsafe_validation = await agent.code_validator.validate_code(unsafe_code)
        print("\nâš ï¸  Unsafe Franco code validation:")
        print(f"   ğŸš¨ Franco loop safety issues: {unsafe_validation.has_franco_loop_safety_issues}")
        print(f"   âŒ Errors: {len(unsafe_validation.errors)}")
        if unsafe_validation.errors:
            print(f"      â†’ {unsafe_validation.errors[0].message}")
        
        # Demonstrate file operations
        print(f"\nğŸ“ FILE OPERATIONS")
        
        # Save generated code
        demo_code = """// Generated by Flex AI Agent Demo
etb3("Hello from Flex AI Agent!")
rakm demo_var = 42
etb3("Demo variable: " + demo_var)
"""
        
        write_op = FileOperation(
            operation="write",
            filepath="temp/demo_output.flex",
            content=demo_code
        )
        
        write_result = await agent.file_manager.execute_operation(write_op)
        print(f"ğŸ’¾ File write: {'âœ… Success' if write_result.success else 'âŒ Failed'}")
        
        # List files
        list_op = FileOperation(
            operation="list",
            filepath="temp/"
        )
        
        list_result = await agent.file_manager.execute_operation(list_op)
        print(f"ğŸ“‚ Directory listing: {'âœ… Success' if list_result.success else 'âŒ Failed'}")
        
        # Demonstrate agent tools integration
        print(f"\nğŸ› ï¸  INTEGRATED TOOLS")
        print("ğŸ”§ All agent tools working together:")
        print("   ğŸ“Š Model Manager: Manages 315+ AI models")
        print("   ğŸ” Code Validator: Validates Flex syntax & safety")
        print("   ğŸ“ File Manager: Handles file I/O operations")
        print("   âš¡ Flex Executor: Ready for code execution")
        print("   ğŸ¤– AI Provider: OpenRouter integration ready")
        
        # Show agent's AI readiness
        print(f"\nğŸ¤– AI CAPABILITIES")
        print("ğŸ¯ Agent is ready for:")
        print("   â€¢ Code generation in Franco & English syntax")
        print("   â€¢ Code validation with safety checks")
        print("   â€¢ File management operations")
        print("   â€¢ Interactive programming assistance")
        print("   â€¢ Multi-model AI provider support")
        
        print(f"\nğŸ’¡ TO USE AI FEATURES:")
        print("   1. Set OPENROUTER_API_KEY environment variable")
        print("   2. Run: python main.py --generate 'create a loop'")
        print("   3. Or run interactive mode: python main.py --interactive")
        
        # Clean up
        delete_op = FileOperation(
            operation="delete",
            filepath="temp/demo_output.flex"
        )
        await agent.file_manager.execute_operation(delete_op)
        
        print(f"\nğŸ‰ DEMONSTRATION COMPLETE!")
        print("ğŸš€ Flex AI Agent is fully operational and ready for use!")
        
        return True
        
    except Exception as e:
        print(f"âŒ Demo failed: {e}")
        import traceback
        traceback.print_exc()
        return False


async def main():
    """Run the agent demonstration."""
    success = await demo_agent_capabilities()
    return 0 if success else 1


if __name__ == "__main__":
    exit_code = asyncio.run(main())
    sys.exit(exit_code)